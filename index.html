<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion D-Day Widget</title>
    <style>
        /* Global Styles */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: transparent; /* Transparent for Notion */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .container {
            display: flex; flex-direction: column; gap: 8px; align-items: flex-start;
        }
        /* Badge Styles */
        .badge {
            padding: 4px 8px; border-radius: 4px; font-size: 14px; font-weight: 500; line-height: 1.2; white-space: nowrap;
        }
        /* Notion Colors */
        .green { color: #448361; background-color: #DDEDEA; }
        .purple { color: #6940A5; background-color: #EAE4F2; }
        .red { color: #D44C47; background-color: #FBE4E4; }
        .gray { color: #9B9A97; background-color: #EBECED; }
    </style>
</head>
<body>
    <div class="container">
        <div id="day-display" class="badge"></div>
        <div id="week-display" class="badge"></div>
    </div>

    <script>
        // ====================================================
        // ⚙️ CONFIGURATION
        // ====================================================
        
        // 1. Get parameters from URL (e.g., ?date=2025-12-25&week=false)
        const urlParams = new URLSearchParams(window.location.search);
        
        // 2. Set Target Date (Default: 2026-07-20)
        const targetDateStr = urlParams.get('date') || "2026-07-20"; 
        
        // 3. Show/Hide Week Info (Default: true)
        const showWeeks = urlParams.get('week') !== 'false'; 

        function updateDday() {
            const today = new Date();
            const target = new Date(targetDateStr);
            
            // Error Handling: Invalid Date
            if (isNaN(target.getTime())) {
                document.getElementById("day-display").textContent = "Invalid Date";
                document.getElementById("day-display").className = "badge red";
                return;
            }

            // Reset time to 00:00:00 for accurate day calculation
            today.setHours(0,0,0,0);
            target.setHours(0,0,0,0);

            // Calculate Difference
            const diffTime = target - today;
            const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            const dayEl = document.getElementById("day-display");
            const weekEl = document.getElementById("week-display");

            // Logic: Day Display
            if (days > 0) {
                dayEl.textContent = `${days} days left`;
                dayEl.className = "badge green"; 
            } else if (days === 0) {
                dayEl.textContent = "D-Day!";
                dayEl.className = "badge red";   
            } else {
                dayEl.textContent = `${Math.abs(days)} days passed`;
                dayEl.className = "badge gray";  
            }

            // Logic: Week Display
            if (showWeeks) {
                const weeks = Math.floor(days / 7);
                weekEl.style.display = "block";

                if (weeks < 0) {
                    weekEl.textContent = `${Math.abs(weeks)} weeks passed`;
                    weekEl.className = "badge red"; 
                } else if (weeks === 0) {
                    weekEl.textContent = "D-Week!";
                    weekEl.className = "badge purple";
                } else {
                    weekEl.textContent = `${weeks} weeks left`;
                    weekEl.className = "badge purple"; 
                }
            } else {
                weekEl.style.display = "none";
            }
        }
        
        // Initialize Widget
        updateDday();
    </script>
</body>
</html>